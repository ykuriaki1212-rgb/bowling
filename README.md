# 🎳 ボウリングスコア記録ダッシュボード

PCとスマホで同じデータを共有できるボウリングスコア記録システムです。
Googleスプレッドシートをデータベースとして使用し、オフラインでも動作します。

---

## 📁 ファイル構成

```
📦 ボウリングスコア記録システム
├── 📄 bowling-score-tracker.html  # メインダッシュボード（ブラウザで開く）
├── 📄 google_apps_script.gs       # Google Apps Scriptコード
└── 📄 README.md                   # このファイル
```

---

## 🚀 クイックスタート（ローカル使用）

スプレッドシート連携なしで、すぐに使い始められます。

### 手順
1. `bowling-score-tracker.html` をブラウザで開く
2. スコアを入力して「保存する」ボタンをクリック
3. データはブラウザのローカルストレージに保存されます

### 特徴
- ✅ インターネット接続不要
- ✅ セットアップ不要
- ❌ デバイス間でデータ共有不可
- ⚠️ ブラウザのデータ削除で記録が消える可能性あり

---

## ☁️ Googleスプレッドシート連携セットアップ

PCとスマホでデータを共有したい場合は、以下の手順でセットアップしてください。

### 📋 前提条件
- Googleアカウント
- Google Chrome または Safari などのモダンブラウザ

---

## 🔧 セットアップ手順

### Step 1: スプレッドシート作成

1. **Google スプレッドシートを新規作成**
   - https://sheets.google.com にアクセス
   - 「空白」をクリックして新しいスプレッドシートを作成
   - スプレッドシート名を「ボーリング記録」に変更

2. **スプレッドシートIDをコピー**
   - URLから以下の部分をコピー
   ```
   https://docs.google.com/spreadsheets/d/【この部分がID】/edit
   ```
   - 例: `1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z`

---

### Step 2: Google Apps Script設定

1. **Apps Scriptエディタを開く**
   - スプレッドシートのメニューから [拡張機能] > [Apps Script] を選択
   - 新しいタブでエディタが開きます

2. **コードを貼り付け**
   - デフォルトの `function myFunction() {}` をすべて削除
   - `google_apps_script.gs` の内容をすべてコピーして貼り付け

3. **SPREADSHEET_IDを設定**
   - コードの2行目を編集:
   ```javascript
   const SPREADSHEET_ID = 'ここに先ほどコピーしたIDを貼り付け';
   ```

4. **プロジェクト名を変更**
   - 「無題のプロジェクト」をクリック
   - 「ボーリング記録API」などの名前に変更
   - 💾 保存アイコンをクリック

---

### Step 3: 初期化テストの実行

1. **testInit関数を実行**
   - 関数選択ドロップダウン（「実行する関数を選択」の隣）から `testInit` を選択
   - ▶️ 実行ボタンをクリック

2. **権限を許可**
   - 初回実行時に「承認が必要です」と表示されます
   - [権限を確認] をクリック
   - Googleアカウントを選択
   - [詳細] > [ボーリング記録API（安全ではないページ）に移動] をクリック
   - [許可] をクリック

3. **実行ログを確認**
   - メニューから [表示] > [ログ] を選択
   - 「✅ 初期化テスト完了!」が表示されればOK
   - エラーが出た場合は SPREADSHEET_ID が正しいか確認

---

### Step 4: ウェブアプリケーションのデプロイ

1. **デプロイメニューを開く**
   - 右上の [デプロイ] ボタン > [新しいデプロイ] を選択

2. **設定を行う**
   - ⚙️ 歯車アイコン（種類を選択）をクリック > [ウェブアプリ] を選択
   - **説明**: 「ボーリング記録API v1」など
   - **次のユーザーとして実行**: 「自分」を選択
   - **アクセスできるユーザー**: 「全員」を選択 ⚠️ 重要
   - [デプロイ] をクリック

3. **ウェブアプリURLをコピー**
   - 表示されたURLをコピー
   - 例: `https://script.google.com/macros/s/AKfycbxxx.../exec`

---

### Step 5: HTMLファイルにURL設定

1. **bowling-score-tracker.html を編集**
   - テキストエディタで `bowling-score-tracker.html` を開く
   - 42行目付近を探す:
   ```javascript
   const API_URL = 'ここにGoogle Apps ScriptのウェブアプリURLを貼り付け';
   ```

2. **URLを貼り付け**
   ```javascript
   const API_URL = 'https://script.google.com/macros/s/AKfycbxxx.../exec';
   ```

3. **保存して閉じる**

---

### Step 6: 動作確認

1. **HTMLファイルをブラウザで開く**
   - `bowling-score-tracker.html` をダブルクリック

2. **同期ステータスを確認**
   - ヘッダー部分に「✅ 同期済み」と表示されればOK
   - 「⚠️ オフライン」の場合は以下を確認:
     - API_URLが正しく設定されているか
     - Apps Scriptが「全員」アクセス可能になっているか
     - ブラウザの開発者ツール（F12）でエラーが出ていないか

3. **スコアを保存してテスト**
   - 適当なスコアを入力して保存
   - スプレッドシートを開いて「スコアデータ」シートにデータが追加されているか確認
   - 「更新ログ」シートに保存ログが記録されているか確認

---

## 📊 スプレッドシートの構成

セットアップ完了後、スプレッドシートには以下のシートが作成されます。

### 1. スコアデータ シート
スコアや設定データが保存されます。

| 列名 | 内容 | 形式 |
|------|------|------|
| スコア（JSON） | すべてのボウリングスコア記録 | JSON配列 |
| 目標 | 目標スコア | 数値 |
| 動画（JSON） | 参考動画リスト | JSON配列 |
| 最終更新 | 更新日時 | タイムスタンプ |

- **データ保持**: 最新50件のみ（古いデータは自動削除）
- ⚠️ **直接編集非推奨**: ダッシュボードから操作してください

### 2. 更新ログ シート
すべての操作履歴が記録されます。

| 列名 | 内容 |
|------|------|
| タイムスタンプ | 操作日時 |
| 操作 | 操作種類（保存/読み込み/初期化など） |
| ユーザー | 実行したGoogleアカウント |
| 詳細 | 操作の詳細情報 |

- **データ保持**: 最新100件のみ

---

## ⚙️ 機能一覧

### 📝 スコア記録機能
- **日付選択**: カレンダーから選択
- **場所入力**: 過去の履歴から候補を自動表示
- **スコア入力**: 0〜300の範囲で入力
- **成長記録**: 500文字以内のメモ
- **自動保存**: ローカル＋クラウドに同時保存

### 📊 統計表示
- 🏆 **自己ベスト**: ハイライト表示
- **全期間平均**: すべてのスコアの平均
- **直近10ゲーム平均**: 最近の調子を確認
- **総ゲーム数**: プレイ回数
- 🔥 **連続記録バッジ**: 100点超え3連続で表示

### 📈 グラフ機能
- **折れ線グラフ**: スコアの推移を視覚化
- **目標ライン**: 目標との差を確認
- **インタラクティブ**: Chart.js使用

### 🎯 目標設定
- 目標スコアを自由に設定
- プログレスバーで達成率を表示
- 達成/未達成メッセージ

### 🎬 参考動画管理
- YouTube動画を最大5件まで登録
- タイトル（50文字）
- サブタイトル（100文字、任意）
- URLから動画に直接アクセス

### 📋 記録履歴
- 新しい順に表示
- 自己ベストに🏆マーク
- 各記録の編集・削除
- 成長記録の展開表示

### 💾 データ管理
- **JSONエクスポート**: バックアップ用
- **自動同期**: オンライン時は自動でクラウド保存
- **オフライン対応**: ネットがなくても動作

---

## 🔐 セキュリティ・プライバシー

### データの保存場所
- **ローカルストレージ**: ブラウザ内（デバイス単位）
- **Googleスプレッドシート**: あなたのGoogleドライブ

### アクセス権限
- スプレッドシートは作成者（あなた）のみが編集可能
- ウェブアプリのURLを知っている人は誰でもアクセス可能
  - ⚠️ URLを他人に教えないでください
  - 必要に応じてApps Scriptの「アクセスできるユーザー」設定を変更可能

---

## ⚠️ 重要な注意事項

### CORS（クロスオリジン）について
- Apps Scriptウェブアプリは「全員」アクセス可能に設定しないとCORSエラーが発生します
- これは技術的な制約です

### ブラウザ互換性
- ✅ Chrome（推奨）
- ✅ Safari
- ✅ Firefox
- ✅ Edge
- ❌ Internet Explorer（非対応）

### データバックアップ
定期的にバックアップを取ることを推奨します:

1. **ダッシュボードから**:
   - 「📥 JSONエクスポート」ボタンでダウンロード

2. **スプレッドシートから**:
   - Apps Scriptエディタで `backupData` 関数を実行
   - 専用のバックアップシートが作成されます

3. **スプレッドシート自体**:
   - [ファイル] > [コピーを作成] で定期的にバックアップ

---

## 🐛 トラブルシューティング

### ❌ 「⚠️ オフライン」が表示される

**原因1**: API_URLが未設定または間違っている
- **解決**: HTMLファイルのAPI_URL設定を確認

**原因2**: Apps Scriptのデプロイ設定が間違っている
- **解決**: 「アクセスできるユーザー」が「全員」になっているか確認

**原因3**: インターネット接続の問題
- **解決**: ネットワーク接続を確認（オフラインでも使用は可能）

---

### ❌ Apps Scriptで「承認が必要です」が消えない

**解決方法**:
1. Apps Scriptエディタでログアウト
2. Googleアカウントを再ログイン
3. testInit関数を再実行
4. 「詳細」>「安全ではないページに移動」を選択

---

### ❌ データが保存されない

**チェックリスト**:
- [ ] SPREADSHEET_IDが正しいか
- [ ] testInit関数が成功したか
- [ ] ウェブアプリがデプロイされているか
- [ ] API_URLがHTMLに設定されているか
- [ ] ブラウザのJavaScriptが有効か

**確認方法**:
1. ブラウザでF12キーを押す
2. 「Console」タブを確認
3. エラーメッセージがあれば内容を確認

---

### ❌ スマホで動かない

**解決方法**:
1. URLを正しく入力しているか確認
2. スマホのブラウザでJavaScriptが有効か確認
3. プライベートブラウズモードを無効にする
4. 別のブラウザ（Chrome、Safariなど）で試す

---

### ❌ グラフが表示されない

**原因**: Chart.jsの読み込みエラー
**解決**: インターネット接続を確認（Chart.jsはCDNから読み込み）

---

### ❌ スプレッドシートのシートが自動作成されない

**解決方法**:
1. Apps Scriptエディタで `testInit` 関数を実行
2. 実行ログで「✅ 初期化テスト完了!」を確認
3. スプレッドシートを更新（F5キー）

---

## 🔄 アップデート・再デプロイ

### Apps Scriptコードを更新した場合

1. Apps Scriptエディタでコードを修正
2. 💾 保存
3. [デプロイ] > [デプロイを管理]
4. 既存のデプロイの鉛筆アイコンをクリック
5. 「バージョン」を「新バージョン」に変更
6. [デプロイ] をクリック

⚠️ URLは変わらないので、HTMLファイルの修正は不要です

---

## 📞 サポート

### よくある質問

**Q: 複数デバイスで同時に使える?**
A: はい。同じAPI_URLを設定すれば、PC、スマホ、タブレット間でデータ共有できます。

**Q: データはいつ同期される?**
A: ページ読み込み時とデータ保存時に自動同期されます。

**Q: オフラインで使える?**
A: はい。オフライン時はローカルストレージのみで動作します。オンライン復帰時に手動でページ更新すると同期されます。

**Q: 家族で共有できる?**
A: はい。同じAPI_URLを共有すれば可能です。ただし全員が同じデータを見るため、個人記録の管理には向きません。

**Q: データは安全?**
A: データはあなたのGoogleドライブに保存されます。URLを第三者に教えなければ、あなた以外アクセスできません。

---

## 📝 ライセンス

このプロジェクトは個人利用・教育目的で自由に使用できます。
Chart.js: MIT License

---

## 🎉 楽しいボウリングライフを!

ご質問や不具合がありましたら、お気軽にお問い合わせください。
良いスコアを目指して頑張ってください! 🎳
